<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Character Stats</title>
<style>
body {
    font-family: 'Garamond', 'Times New Roman', serif;
    background-color: #1c1c1c;
    color: #f5d083;
    margin: 18px;
}
h1 {
    text-align: center;
    color: #f5d083;
    text-shadow: 2px 2px 4px #000;
}
.summary {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}
.card {
    background-color: #2b2b2b;
    padding: 16px 24px;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(245,208,131,0.5);
    text-align: center;
    min-width: 120px;
}
.card h2 {
    margin: 0;
    font-size: 1.1rem;
    color: #f5d083;
}
.card p {
    margin: 4px 0 0 0;
    font-size: 1.1rem;
    font-weight: bold;
    color: #fff;
}
</style>
</head>
<body>

<h1>Character Stats</h1>
<p style="text-align:center">Last Updated: <span id="lastUpdated">-</span></p>

<div class="summary">
  <div class="card"><h2>Total Items</h2><p id="totalItems">0</p></div>
  <div class="card"><h2>Total Unique/Set</h2><p id="totalUnique">0</p></div>
  <div class="card"><h2>Total Runes</h2><p id="totalRunes">0</p></div>
</div>

<script>
async function loadTotals() {
    try {
        const response = await fetch("/webportal/data/pvpgn_server_totals.json");
        const data = await response.json();

        document.getElementById("totalItems").textContent = data.total_items || 0;
        document.getElementById("totalUnique").textContent = data.total_unique_set || 0;
        document.getElementById("totalRunes").textContent = data.total_runes || 0;

        document.getElementById("lastUpdated").textContent = new Date().toLocaleString();

    } catch (e) {
        console.error("Error loading totals:", e);
    }
}

loadTotals();
</script>
<div style="margin-top:40px;">
<h2 style="text-align:center">Characters</h2>
<table id="charactersTable" style="width:100%; border-collapse: collapse; background-color:#2b2b2b; border:2px solid #f5d083;">
<thead>
<tr style="background-color:#3a2f2f; color:#f5d083; text-shadow:1px 1px 2px #000;">
<th>Character</th>
<th>Level</th>
<th>Exp</th>
<th>Items</th>
<th>Runes</th>
<th>Unique/Set</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<script>
async function loadCharacters() {
    try {
        const response = await fetch("/webportal/data/webportal_combined.json");
        const data = await response.json();
        const tbody = document.querySelector("#charactersTable tbody");
        tbody.innerHTML = "";

        const accounts = data.accounts || {};

        // Loop over all accounts
        Object.keys(accounts).forEach(acc => {
            if (acc === "Unknown") return; // skip Unknown accounts

            const accData = accounts[acc];
            const chars = accData.characters || {};

            // Sometimes chars object may contain "characters" again (nested)
            const charEntries = chars.characters || chars;

            Object.keys(charEntries).forEach(charName => {
                const charData = charEntries[charName];
                if (!charData || typeof charData !== "object") return;

                const summary = charData.summary || {};

                const row = `
                    <tr>
                        <td>${charName}</td>
                        <td>${charData.level || "-"}</td>
                        <td>${charData.exp || "-"}</td>
                        <td>${summary.total_items || 0}</td>
                        <td>${summary.total_runes || 0}</td>
                        <td>${summary.total_unique_set || 0}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        });

    } catch(e) {
        console.error("Error loading characters:", e);
    }
}
loadCharacters();
</script>

</body>
</html>

